<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/dashboardpage.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuP+VmmDGMN5t9UJ0Z"
    crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
</head>

<body class="main-home-page">
    <%- include('../utils/header') %>

    <div class="welcome-section">
        <h1>Welcome, <span><%= userName %></span>!</h1>
        <button onclick="location.href='/edit-profile'">Edit Profile</button>
    </div>

    <div class="achievements-section">
        <h2>Achievements</h2>
        <div class="badges">
            <% achievements.forEach(function(achievement) { %>
                <div class="badge">
                    <img src="<%= achievement.badgeImage %>" alt="<%= achievement.name %>">
                    <p><%= achievement.name %></p>
                </div>
            <% }); %>
        </div>
    </div>

    <div class="progress-section">
        <h2>Games Progress</h2>
        <div id="gamesProgress">
            <% if (games && games.length > 0) { %>
                <% games.forEach(function(game) { %>
                    <div class="game" data-game-id="<%= game.id %>">
                        <h3><%= game.title %></h3>
                        <!-- To ensure the correct format -->
                        <p></p>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" aria-valuenow="<%= game.progress_percentage %>" aria-valuemin="0" aria-valuemax="100">
                                <%= game.progress_percentage %>%
                            </div>
                        </div>
                        <p>Elapsed Time: <%= game.elapsed_minutes %> minutes</p>
                        <p>Status: <%= game.progress_percentage >= 100 ? 'Completed' : game.progress_percentage.toFixed(2) + '% Completed' %></p>
                    </div>
                <% }); %>
            <% } else { %>
                <p>No games available.</p>
            <% } %>
        </div>
    </div>
    
    

    <div class="goals-section">
        <h2>My Goals</h2>
        <p>Setting goals can help you feel better and more balanced. Think about what you can do to take care of yourself and improve your mental health. Your goals might include practicing something you enjoy, talking to someone you trust, or trying out new activities. Here are some examples:</p>
        <ul>
            <li>Spend 10 minutes each day doing a fun hobby.</li>
            <li>Practice deep breathing exercises when feeling stressed.</li>
            <li>Talk to a friend or family member about how you‚Äôre feeling.</li>
        </ul>
        <p>Write down your goals below. Remember, your goals can be big or small ‚Äì what matters is that they help you feel happier and healthier!</p>
        <!-- Add more goals form with CSS -->
        <form action="/add-more-goals" method="post" class="add-more-goals-form mb-3">
            <input type="text" name="newGoal" placeholder="Enter new goal...">
            <button type="submit" class="add-goal-btn">Add New Goal</button>
        </form>
    
        <!-- Display the current goals in a column -->
        <% if (goalsText && goalsText.trim().length > 0) { %>
          <div class="goals-display mb-3">
            <p><strong>Current Goals:</strong></p>
            <ul>
              <% const goalsArray = goalsText.split("\n").filter(goal => goal.trim().length > 0).reverse(); %>
              <% goalsArray.forEach((goal, index) => { %>
                <li class="goal-item">
                  <span class="goal-text"><%= goal %></span>
                  <form action="/delete-goal" method="post" class="delete-goal-form">
                    <input type="hidden" name="goalIndex" value="<%= goalsArray.length - 1 - index %>">
                    <button type="submit" class="delete-goal-btn">
                      üóëÔ∏è
                    </button>
                  </form>
                </li>
              <% }); %>
            </ul>
          </div>
        <% } else { %>
          <p>No goals set yet.</p>
        <% } %>
    </div>
    

 <!-- Include the footer -->
 <%- include('../utils/footer') %>
</body>
</html>
